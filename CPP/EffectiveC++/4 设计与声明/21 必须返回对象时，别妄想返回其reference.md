> 21 必须返回对象时，别妄想返回其reference

# 问题

错误：reference指向不存在的对象

比如：

- 函数退出后，返回已经被释放对象的引用

```c++
const Obj& operator*(const Obj& a, const Obj& b)
{
    Obj c = ...;
    return c;
}
```

c在函数退出后，已经被释放（Local Stack对象）。

# 尝试解决

如果Heap上分配对象，释放的责任不清晰；而且可能出现下面的情况导致泄露产生。

```c++
w = x * y * z;
```

如果用一个static对象记录结果，即x与y的运算结果存储到static对象中，与z相乘时复用static对象记录结果；可能出现的问题

1. 多线程安全问题
2. 需要两个计算结果的情况下，第一个被顶掉

```c++
if (a * b == c * d) // always true
```

如果增加static对象的数量

- 数量多少合适是问题
- 复用的过程中的赋值成本等

# 结论

“必须返回新对象”的函数的正确写法是：就让那个函数返回一个新对象。

